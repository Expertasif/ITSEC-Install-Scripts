#!/bin/bash

bold=$(tput bold)
normal=$(tput sgr0)

echo "${bold}
 _  __   ___   _ ___ ____  
| | \ \ / / \ | |_ _/ ___| 
| |  \ V /|  \| || |\___ \ 
| |___| | | |\  || | ___) |
|_____|_| |_| \_|___|____/ 
                                                         
${normal}"

mkdir -p /opt/ITSEC/2.Vulnerability-Scanner/lynis/CISOfy
cd /opt/ITSEC/2.Vulnerability-Scanner/lynis/CISOfy
git clone https://github.com/CISOfy/lynis.git

GITREPOROOT=/opt/ITSEC/2.Vulnerability-Scanner/lynis/CISOfy/lynis

DSKTPFLS=/opt/ITSEC-Install-Scripts/0.Initial/usrlcl/.local/share/applications/2.Vulnerability-Scanner
DSKTPFLSDEST=/home/$USER/.local/share/applications/2.Vulnerability-Scanner
DSKTPFL=lynis.desktop

cd $GITREPOROOT
git clean -f
git fetch origin
git reset --hard origin/master
git pull
git submodule init
git submodule update --recursive
sudo rm -f /usr/local/bin/lynis
echo '#!/bin/bash

cd /opt/ITSEC/2.Vulnerability-Scanner/lynis/CISOfy/lynis

./lynis "$@"' > lynis.sh
chmod +x lynis.sh
chmod +x lynis
sudo ln -s /opt/ITSEC/2.Vulnerability-Scanner/lynis/CISOfy/lynis/lynis.sh /usr/local/bin/lynis
rm -f $DSKTPFLSDEST/$DSKTPFL
mkdir -p $DSKTPFLSDEST
cp $DSKTPFLS/$DSKTPFL $DSKTPFLSDEST/$DSKTPFL