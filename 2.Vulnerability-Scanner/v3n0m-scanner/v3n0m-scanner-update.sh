#!/bin/bash

bold=$(tput bold)
normal=$(tput sgr0)

echo "${bold}
__     _______ _   _  ___  __  __ 
\ \   / /___ /| \ | |/ _ \|  \/  |
 \ \ / /  |_ \|  \| | | | | |\/| |
  \ V /  ___) | |\  | |_| | |  | |
   \_/  |____/|_| \_|\___/|_|  |_|
           
${normal}"

mkdir -p /opt/ITSEC/2.Vulnerability-Scanner/v3n0m-scanner/v3n0m-scanner
cd /opt/ITSEC/2.Vulnerability-Scanner/v3n0m-scanner/v3n0m-scanner
git clone https://github.com/v3n0m-scanner/V3n0M-Scanner.git

GITREPOROOT=/opt/ITSEC/2.Vulnerability-Scanner/v3n0m-scanner/v3n0m-scanner/V3n0M-Scanner

DSKTPFLS=/opt/ITSEC-Install-Scripts/0.Initial/usrlcl/.local/share/applications/2.Vulnerability-Scanner
DSKTPFLSDEST=/home/$USER/.local/share/applications/2.Vulnerability-Scanner
DSKTPFL=v3n0m.desktop

sudo rm -f /usr/local/bin/v3n0m

cd $GITREPOROOT
git clean -f
git fetch origin
git reset --hard origin/master
git pull
git submodule init && git submodule update --recursive
sudo python3 setup.py install #doesent work as it seems, lets link that up ..

cd /opt/ITSEC/2.Vulnerability-Scanner/v3n0m-scanner/v3n0m-scanner/V3n0M-Scanner/src

rm -f v3n0m.sh
echo '#!/bin/bash

cd /opt/ITSEC/2.Vulnerability-Scanner/v3n0m-scanner/v3n0m-scanner/V3n0M-Scanner/src

python3 v3n0m.py "$@"' > v3n0m.sh

chmod +x v3n0m.sh

sudo ln -s /opt/ITSEC/2.Vulnerability-Scanner/v3n0m-scanner/v3n0m-scanner/V3n0M-Scanner/src/v3n0m.sh /usr/local/bin/v3n0m
rm -f $DSKTPFLSDEST/$DSKTPFL
mkdir -p $DSKTPFLSDEST
cp $DSKTPFLS/$DSKTPFL $DSKTPFLSDEST/$DSKTPFL
