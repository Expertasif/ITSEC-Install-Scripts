#!/bin/bash

bold=$(tput bold)
normal=$(tput sgr0)

echo "${bold}
__        _______   _    _____ 
\ \      / /___ /  / \  |  ___|
 \ \ /\ / /  |_ \ / _ \ | |_   
  \ V  V /  ___) / ___ \|  _|  
   \_/\_/  |____/_/   \_\_|    
           
${normal}"

mkdir -p /opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho
cd /opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho
git clone https://github.com/andresriancho/w3af.git

GITREPOROOT=/opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af
EXECUTEABLE1=w3af_console
EXECUTEABLE1GUI=w3af_gui

#sudo -H pip2 install pyopenSSL==17.0.0 joe  PyGithub GitPython futures pyOpenSSL lxml scapy-real guess-language ruamel.ordereddict tldextract

#sudo -H pip2 install   odict Jinja2 pyClamd PyGithub GitPython nltk chardet tblib futures pyOpenSSL ndg-httpsclient lxml scapy-real==2.2.0-dev guess-language msgpack-python python-ntlm darts.util.lru Jinja2 markdown psutil mitmproxy ruamel.ordereddict PyYAML tldextract


sudo ldconfig
sudo updatedb

sudo rm /usr/local/bin/$EXECUTEABLE1
sudo rm /usr/local/bin/$EXECUTEABLE1GUI

cd $GITREPOROOT
git clean -f
git fetch origin
git reset --hard origin/master
git pull
git checkout develop
git pull
git submodule init 
git submodule update --recursive


# Lets do this with virtualenv ....

# write an install script for the venv routine and run it for each
echo '#!/bin/bash

cd /opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af

virtualenv venv
. venv/bin/activate
./w3af_console
. /tmp/user/1000/w3af_dependency_install.sh' > installvenv_w3af_console.sh

chmod +x installvenv_w3af_console.sh
./installvenv_w3af_console.sh

echo '#!/bin/bash

cd /opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af

sudo apt-get install python-gtksourceview2 python-gtk2
virtualenv --system-site-packages venv
. venv/bin/activate
./w3af_gui
. /tmp/user/1000/w3af_dependency_install.sh' > installvenv_w3af_gui.sh

chmod +x installvenv_w3af_gui.sh
./installvenv_w3af_gui.sh



#cp /opt/ITSEC-Install-Scripts/2.Vulnerability-Scanner/w3af-files/requirements.py /opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af/w3af/core/controllers/dependency_check/requirements.py

echo '#!/bin/bash

cd /opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af

. venv/bin/activate
./w3af_console "$@"' > w3af_console.sh

chmod +x w3af_console.sh

echo '#!/bin/bash

cd /opt/ITSEC/2.Vulnerability-Scanner/w3af/andresriancho/w3af

. venv/bin/activate 
./w3af_gui "$@"' > w3af_gui.sh

chmod +x w3af_gui.sh
sudo ln -s $GITREPOROOT/w3af_console.sh /usr/local/bin/$EXECUTEABLE1
sudo ln -s $GITREPOROOT/w3af_gui.sh /usr/local/bin/$EXECUTEABLE1GUI
#cd /opt/ITSEC/7.Mitm/7.Mitm/mitmproxy python-git python3-git
#sudo apt-get purge --remove python-enum34
#sudo -H pip2 install enum34 twisted


