#!/bin/bash

bold=$(tput bold)
normal=$(tput sgr0)

echo "${bold}
__        ______       _______  __     _____ __  ____        ______  _  __
\ \      / /  _ \     | ____\ \/ /    |  ___|  \/  \ \      / /  _ \| |/ /
 \ \ /\ / /| |_) |____|  _|  \  /_____| |_  | |\/| |\ \ /\ / /| |_) | ' / 
  \ V  V / |  __/_____| |___ /  \_____|  _| | |  | | \ V  V / |  _ <| . \ 
   \_/\_/  |_|        |_____/_/\_\    |_|   |_|  |_|  \_/\_/  |_| \_\_|\_\
                                                                          
                                                   
${normal}"

mkdir -p /opt/ITSEC/2.Vulnerability-Scanner/wordpress-exploit-framework/rastating
cd /opt/ITSEC/2.Vulnerability-Scanner/wordpress-exploit-framework/rastating
git clone https://github.com/rastating/wordpress-exploit-framework

sudo apt-get install build-essential patch
sudo apt-get install ruby-dev zlib1g-dev liblzma-dev

. ~/.bashrc
eval "$(rbenv init -)"
yes "N" | rbenv install 2.4.1 
rbenv rehash
rbenv shell 2.4.1 
sudo updatedb
sudo ldconfig

GITREPOROOT=/opt/ITSEC/2.Vulnerability-Scanner/wordpress-exploit-framework/rastating/wordpress-exploit-framework
GITREPOBINDIR=/opt/ITSEC/2.Vulnerability-Scanner/wordpress-exploit-framework/rastating/wordpress-exploit-framework/bin
GITREPOGITFILE=$GITREPOROOT/.git
DSKTPFLS=/opt/ITSEC-Install-Scripts/0.Initial/usrlcl/.local/share/applications/2.Vulnerability-Scanner
DSKTPFLSDEST=/home/$USER/.local/share/applications/2.Vulnerability-Scanner
DSKTPFL=wordpress-exploit-framework.desktop

sudo rm -f /usr/local/bin/arachni*
cd $GITREPOROOT
git clean -f
git fetch origin
git reset --hard origin/master
git pull
git submodule init
git submodule update --recursive
gem install bundler
bundle update
bundle install
#gem uninstall arachni
#gem install arachni
#gem install rake
#cd $GITREPOBINDIR

echo '#!/bin/bash 

cd /opt/ITSEC/2.Vulnerability-Scanner/wordpress-exploit-framework/rastating/wordpress-exploit-framework

source ~/.bashrc
eval "$(rbenv init -)"
rbenv shell 2.4.1
ruby wpxf.rb "$@"
' > wpxf.sh 

chmod +x $GITREPOROOT/wpxf.sh
sudo rm -f /usr/local/bin/wordpress-exploit-framework
sudo ln -s $GITREPOROOT/wpxf.sh /usr/local/bin/wordpress-exploit-framework
rm -f $DSKTPFLSDEST/$DSKTPFL
mkdir -p $DSKTPFLSDEST
cp $DSKTPFLS/$DSKTPFL $DSKTPFLSDEST/$DSKTPFL



