#!/bin/bash

bold=$(tput bold)
normal=$(tput sgr0)

echo "${bold}
    _    ____      _    ____ _   _ _   _ ___ 
   / \  |  _ \    / \  / ___| | | | \ | |_ _|
  / _ \ | |_) |  / _ \| |   | |_| |  \| || | 
 / ___ \|  _ <  / ___ \ |___|  _  | |\  || | 
/_/   \_\_| \_\/_/   \_\____|_| |_|_| \_|___|
       
${normal}"


sudo ldconfig
sudo updatedb

mkdir -p /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni
cd /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni
git clone https://github.com/Arachni/arachni.git

. ~/.bashrc
eval "$(rbenv init -)"
rbenv install 2.3.3
rbenv rehash
rbenv shell 2.3.3
sudo updatedb
sudo ldconfig

GITREPOROOT=/opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni/arachni
GITREPOBINDIR=/opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni/arachni/bin

DSKTPFLS=/opt/ITSEC-Install-Scripts/0.Initial/usrlcl/.local/share/applications/2.Vulnerability-Analysis/1.Vulnerability-Scanner
DSKTPFLSDEST=/home/$USER/.local/share/applications/2.Vulnerability-Analysis/1.Vulnerability-Scanner
DSKTPFL=arachni.desktop



sudo rm -f /usr/local/bin/arachni*
cd $GITREPOROOT
git clean -f
git fetch origin
git reset --hard origin/master
git pull
git submodule init
git submodule update --recursive
gem install bundler
bundle update
bundle install
gem uninstall arachni
gem install arachni
gem install rake
cd $GITREPOBINDIR

#ARACHNI=arachni
#ARACHNI_CONSOLE=arachni_console
#ARACHNI_MULTI=arachni_multi
#ARACHNI_REPORTER=arachni_reporter
#ARACHNI_RESTORE=arachni_restore
#ARACHNI_REPRODUCE=arachni_reproduce 
#ARACHNI_REST_SERVER=arachni_rest_server
#ARACHNI_RPC=arachni_rpc
#ARACHNI_RPCD=arachni_rpcd
#ARACHNI_RPCD_MONITOR=arachni_rpcd_monitor
#ARACHNI_SCRIPT=arachni_script
#sudo bash -c 'for ARACHNI in $(ls arachni*); do ln -s /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni/arachni/bin/$ARACHNI /usr/local/bin/$ARACHNI;done'


echo '#!/bin/bash 

cd /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni/arachni/bin
source ~/.bashrc
eval "$(rbenv init -)"
rbenv shell 2.3.3 
./arachni
' > arachni.sh 

chmod +x $GITREPOBINDIR/arachni.sh
sudo rm -f /usr/local/bin/arachni.sh
sudo ln -s $GITREPOBINDIR/arachni.sh /usr/local/bin/arachni.sh

echo '#!/bin/bash 

cd /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni/arachni/bin
source ~/.bashrc
eval "$(rbenv init -)"
rbenv shell 2.3.3 
./arachni_console
' > arachni_console.sh 

chmod +x $GITREPOBINDIR/arachni_console.sh
sudo rm -f /usr/local/bin/arachni_console.sh
sudo ln -s $GITREPOBINDIR/arachni_console.sh /usr/local/bin/arachni_console.sh

echo '#!/bin/bash 

cd /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni/arachni/bin
source ~/.bashrc
eval "$(rbenv init -)"
rbenv shell 2.3.3 
./arachni_multi
' > arachni_multi.sh 

chmod +x $GITREPOBINDIR/arachni_multi.sh
sudo rm -f /usr/local/bin/arachni_multi.sh
sudo ln -s $GITREPOBINDIR/arachni_multi.sh /usr/local/bin/arachni_multi.sh

echo '#!/bin/bash 

cd /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni/arachni/bin
source ~/.bashrc
eval "$(rbenv init -)"
rbenv shell 2.3.3 
./arachni_reporter
' > arachni_reporter.sh 

chmod +x $GITREPOBINDIR/arachni_reporter.sh
sudo rm -f /usr/local/bin/arachni_reporter.sh
sudo ln -s $GITREPOBINDIR/arachni_reporter.sh /usr/local/bin/arachni_reporter.sh

echo '#!/bin/bash 

cd /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni/arachni/bin
source ~/.bashrc
eval "$(rbenv init -)"
rbenv shell 2.3.3 
./arachni_restore
' > arachni_restore.sh 

chmod +x $GITREPOBINDIR/arachni_restore.sh
sudo rm -f /usr/local/bin/arachni_restore.sh
sudo ln -s $GITREPOBINDIR/arachni_restore.sh /usr/local/bin/arachni_restore.sh

echo '#!/bin/bash 

cd /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni/arachni/bin
source ~/.bashrc
eval "$(rbenv init -)"
rbenv shell 2.3.3 
./arachni_reproduce
' > arachni_reproduce.sh 

chmod +x $GITREPOBINDIR/arachni_reproduce.sh
sudo rm -f /usr/local/bin/arachni_reproduce.sh
sudo ln -s $GITREPOBINDIR/arachni_reproduce.sh /usr/local/bin/arachni_reproduce.sh

echo '#!/bin/bash 

cd /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni/arachni/bin
source ~/.bashrc
eval "$(rbenv init -)"
rbenv shell 2.3.3 
./arachni_rest_server
' > arachni_rest_server.sh 

chmod +x $GITREPOBINDIR/arachni_rest_server.sh
sudo rm -f /usr/local/bin/arachni_rest_server.sh
sudo ln -s $GITREPOBINDIR/arachni_rest_server.sh /usr/local/bin/arachni_rest_server.sh

echo '#!/bin/bash 

cd /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni/arachni/bin
source ~/.bashrc
eval "$(rbenv init -)"
rbenv shell 2.3.3 
./arachni_rpc
' > arachni_rpc.sh 

chmod +x $GITREPOBINDIR/arachni_rpc.sh
sudo rm -f /usr/local/bin/arachni_rpc.sh
sudo ln -s $GITREPOBINDIR/arachni_rpc.sh /usr/local/bin/arachni_rpc.sh

#sudo ln -s $GITREPOBINDIR/arachni_rpcd /usr/local/bin/arachni_rpcd 
#sudo ln -s $GITREPOBINDIR/arachni_rpcd_monitor /usr/local/bin/arachni_rpcd_monitor

echo '#!/bin/bash 

cd /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/arachni/Arachni/arachni/bin
source ~/.bashrc
eval "$(rbenv init -)"
rbenv shell 2.3.3 
./arachni_script
' > arachni_script.sh 

chmod +x $GITREPOBINDIR/arachni_script.sh
sudo rm -f /usr/local/bin/arachni_script.sh
sudo ln -s $GITREPOBINDIR/arachni_script.sh /usr/local/bin/arachni_script.sh

mkdir -p $DSKTPFLSDEST
cp $DSKTPFLS/$DSKTPFL $DSKTPFLSDEST/$DSKTPFL



