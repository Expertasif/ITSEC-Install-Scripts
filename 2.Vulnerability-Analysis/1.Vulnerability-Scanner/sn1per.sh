#!/bin/bash	


mkdir -p /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/sn1per/1N3
cd /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/sn1per/1N3
git clone https://github.com/1N3/sn1per.git

sudo -H pip install dnspython colorama tldextract urllib3 ipaddress 
sudo updatedb
sudo ldconfig

GITREPOROOT=/opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/sn1per/1N3/Sn1per
#
DSKTPFLS=/opt/ITSEC-Install-Scripts/0.Initial/usrlcl/.local/share/applications/2.Vulnerability-Analysis/1.Vulnerability-Scanner
DSKTPFLSDEST=/home/$USER/.local/share/applications/2.Vulnerability-Analysis/1.Vulnerability-Scanner
DSKTPFL=sn1per.desktop

#
cd $GITREPOROOT
gem install ruby-nmap net-http-persistent mechanize text-table
git submodule init
git submodule update --recursive
git clean -f
git fetch origin
git reset --hard origin/master
git pull
# VARS
OKBLUE='\033[94m'
OKRED='\033[91m'
OKGREEN='\033[92m'
OKORANGE='\033[93m'
RESET='\e[0m'

echo -e "$OKRED                ____               $RESET"
echo -e "$OKRED    _________  /  _/___  ___  _____$RESET"
echo -e "$OKRED   / ___/ __ \ / // __ \/ _ \/ ___/$RESET"
echo -e "$OKRED  (__  ) / / // // /_/ /  __/ /    $RESET"
echo -e "$OKRED /____/_/ /_/___/ .___/\___/_/     $RESET"
echo -e "$OKRED               /_/                 $RESET"
echo -e "$RESET"
echo -e "$OKORANGE + -- --=[http://crowdshield.com$RESET"
echo ""

INSTALL_DIR=/opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/sn1per/1N3/Sn1per
LOOT_DIR=/usr/share/sniper/loot
PLUGINS_DIR=/usr/share/sniper/plugins


mkdir -p $INSTALL_DIR 2> /dev/null
mkdir -p $LOOT_DIR 2> /dev/null
mkdir $LOOT_DIR/domains 2> /dev/null
mkdir $LOOT_DIR/screenshots 2> /dev/null
mkdir $LOOT_DIR/nmap 2> /dev/null
mkdir $LOOT_DIR/reports 2> /dev/null
mkdir $LOOT_DIR/output 2> /dev/null
cp -Rf $PWD/* $INSTALL_DIR 
cd $INSTALL_DIR

echo -e "$OKORANGE + -- --=[Cleaning up old extensions...$RESET"
rm -Rf Findsploit/ BruteX/ Goohak/ XSSTracer/ MassBleed/ SuperMicro-Password-Scanner/ CMSmap/ yasuo/ Sublist3r/ shocker/ jexboss/ serializekiller/ testssl.sh/ SimpleEmailSpoofer/ ssh-audit/ plugins/ 2> /dev/null
mkdir $PLUGINS_DIR
cd $PLUGINS_DIR
mkdir -p $PLUGINS_DIR/nmap_scripts/ 2> /dev/null

echo -e "$OKORANGE + -- --=[Downloading extensions...$RESET"
git clone https://github.com/1N3/Findsploit.git 
git clone https://github.com/1N3/BruteX.git 
git clone https://github.com/1N3/Goohak.git 
git clone https://github.com/1N3/XSSTracer.git 
git clone https://github.com/1N3/MassBleed.git 
git clone https://github.com/1N3/SuperMicro-Password-Scanner 
git clone https://github.com/Dionach/CMSmap.git 
git clone https://github.com/0xsauby/yasuo.git 
git clone https://github.com/johndekroon/serializekiller.git 
git clone https://github.com/aboul3la/Sublist3r.git 
git clone https://github.com/nccgroup/shocker.git 
git clone https://github.com/drwetter/testssl.sh.git 
git clone https://github.com/lunarca/SimpleEmailSpoofer 
git clone https://github.com/arthepsy/ssh-audit 
wget https://svn.nmap.org/nmap/scripts/http-vuln-cve2017-5638.nse -O /usr/share/nmap/scripts/http-vuln-cve2017-5638.nse
cp $PWD/bin/iis-buffer-overflow.nse /usr/share/nmap/scripts/iis-buffer-overflow.nse
echo -e "$OKORANGE + -- --=[Setting up environment...$RESET"
cd $PLUGINS_DIR/Findsploit/ && bash install.sh
cd $PLUGINS_DIR/BruteX/ && bash install.sh
cd $INSTALL_DIR 
mkdir $LOOT_DIR 2> /dev/null
mkdir $LOOT_DIR/screenshots/ -p 2> /dev/null
mkdir $LOOT_DIR/nmap -p 2> /dev/null
mkdir $LOOT_DIR/domains -p 2> /dev/null
mkdir $LOOT_DIR/output -p 2> /dev/null
mkdir $LOOT_DIR/reports -p 2> /dev/null
cp -f $INSTALL_DIR/bin/clamav-exec.nse /usr/share/nmap/scripts/ 2> /dev/null
chmod +x $INSTALL_DIR/sniper
chmod +x $INSTALL_DIR/bin/dnsdict6
chmod +x $PLUGINS_DIR/Goohak/goohak
chmod +x $PLUGINS_DIR/XSSTracer/xsstracer.py
chmod +x $PLUGINS_DIR/MassBleed/massbleed
chmod +x $PLUGINS_DIR/MassBleed/heartbleed.py
chmod +x $PLUGINS_DIR/MassBleed/openssl_ccs.pl
chmod +x $PLUGINS_DIR/MassBleed/winshock.sh 
chmod +x $PLUGINS_DIR/SuperMicro-Password-Scanner/supermicro_scan.sh
chmod +x $PLUGINS_DIR/testssl.sh/testssl.sh
sudo rm -f /usr/bin/sniper
sudo rm -f /usr/bin/goohak
sudo rm -f /usr/bin/xsstracer
sudo rm -f /usr/bin/findsploit
sudo rm -f /usr/bin/copysploit
sudo rm -f /usr/bin/compilesploit
sudo rm -f /usr/bin/massbleed
sudo rm -f /usr/bin/testssl
sudo ln -s $INSTALL_DIR/sniper /usr/bin/sniper
sudo ln -s $PLUGINS_DIR/Goohak/goohak /usr/bin/goohak
sudo ln -s $PLUGINS_DIR/XSSTracer/xsstracer.py /usr/bin/xsstracer
sudo ln -s $PLUGINS_DIR/Findsploit/findsploit /usr/bin/findsploit
sudo ln -s $PLUGINS_DIR/Findsploit/copysploit /usr/bin/copysploit
sudo ln -s $PLUGINS_DIR/Findsploit/compilesploit /usr/bin/compilesploit
sudo ln -s $PLUGINS_DIR/MassBleed/massbleed /usr/bin/massbleed
sudo ln -s $PLUGINS_DIR/testssl.sh/testssl.sh /usr/bin/testssl
echo -e "$OKORANGE + -- --=[Done!$RESET"
echo -e "$OKORANGE + -- --=[To run, type 'sniper'! $RESET"
mkdir -p $DSKTPFLSDEST
cp $DSKTPFLS/$DSKTPFL $DSKTPFLSDEST/$DSKTPFL
chmod +x /opt/ITSEC/2.Vulnerability-Analysis/1.Vulnerability-Scanner/sn1per/1N3/Sn1per/sniper
